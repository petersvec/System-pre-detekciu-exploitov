 /*
        |ID (2B)|Flags (2B)|Counts (8B)|query_name|0x00|type (2B)|class (2B)|

query_name - napr. www.google.sk => 0x03www0x06google0x02sk

(12B) |0x03www0x06google0x02sk|0x00|_       _|_        _| 
(12B) |query_name             |0x00|type (2B)|class (2B)|

PREFIX = 12B from DnsPacket

*/

package tisma.fflux;

import java.util.ArrayList;
import java.util.Arrays;
import org.jnetpcap.packet.PcapPacket;
import helpers.TParser;

/**
 *
 * @author Lukas Lences
 */
public class DnsQuery extends DnsPacket{
        
    DnsQuery(PcapPacket packet) {  
        super(packet);
        this.QNAME = new ArrayList<>();
       
        byte[] payload = this.udp.getPayload();        
        this.QNAME.add(TParser.domainNameReader(payload, PREFIX));
        this.QTYPE = TParser.parseFrom2BytesToInt(Arrays.copyOfRange(payload, PREFIX+this.QNAME.get(0).length()+1, PREFIX+this.QNAME.get(0).length()+3));
        this.QCLASS = TParser.parseFrom2BytesToInt(Arrays.copyOfRange(payload, PREFIX+this.QNAME.get(0).length()+3, PREFIX+this.QNAME.get(0).length()+5));
        
      /*  System.out.printf("#%d DNS QUERY \tid: %s \tsrc: %s \tname: %s \ttype: %d \tclass: %d%n ",
                packet.getFrameNumber(), FormatUtils.asString(this.ID),
                FormatUtils.ip(sIP), this.QNAME.get(0),
                this.QTYPE, this.QCLASS);*/
    }
    
}
