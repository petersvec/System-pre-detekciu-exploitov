#include "AgentSearch.hpp"

void AgentSearch::run()
{
	asio::io_service io_service;
	asio::error_code error;
	asio::ip::udp::socket udpSocket(io_service);

	udpSocket.open(asio::ip::udp::v4(), error);

	if (!error)
	{
		udpSocket.set_option(asio::ip::udp::socket::reuse_address(true));
		udpSocket.set_option(asio::socket_base::broadcast(true));

		asio::ip::udp::endpoint senderEndpoint(asio::ip::address_v4::broadcast(), 1024);

		std::cout << "Broadcasting message: " << mMessage << std::endl;
		udpSocket.send_to(asio::buffer(mMessage.c_str(), mMessage.size()), senderEndpoint);
		udpSocket.close();
	}
}