#pragma once

#include <asio.hpp>
#include <thread>
#include <memory>
#include <map>
#include <string>
#include <iostream>

#include "TCPConnection.hpp"

class TCPServer {
private:
	// hlavne vlakno ktore pocuva pre prichadzajuce tcp spojenia
	std::thread mMainThread;

	// port na ktorom pocuvame
	int mPort;
	
	std::unique_ptr<asio::ip::tcp::acceptor> mAcceptor;
	std::unique_ptr<asio::io_service> mService;

	// otvorene spojenia
	std::map<std::string, std::unique_ptr<TCPConnection>> mOpenedConnections;
public:
	TCPServer(int tcpPort);

	void run();
	void join();

	int getPort() const { return mPort; }

	std::unique_ptr<asio::io_service> getService() { return std::move(mService); }
	std::unique_ptr<asio::ip::tcp::acceptor> getAcceptor() { return std::move(mAcceptor); }
};