/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package netflowscleaner;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 *
 * @author Lukas Lences
 */
public class NetflowsCleaner {

    /**
     * @param args the command line arguments
     */
    public static void main(String[] args) throws IOException  {
        ArrayList<String> originalFlows = new ArrayList<>();
        ArrayList<String> parsedFLows = new ArrayList<>();
        BufferedReader br = null;
        String filename = args[0];
        try {
            br = new BufferedReader(new FileReader(filename));
            String line;
            while ((line = br.readLine()) != null) {     
                originalFlows.add(line);                
            }
            br.close();
        } catch (FileNotFoundException ex) {
            Logger.getLogger(NetflowsCleaner.class.getName()).log(Level.SEVERE, null, ex);
        } 
        
        System.out.println("Parsing...");
        for (int i =1; i< originalFlows.size(); i++) {            
            String f = originalFlows.get(i);
          //  System.out.println(f);
            String data[] = f.split("\t"); 
            if (data.length < 12){
                if (data.length == 1){
                    String data2[] = data[0].split(" ");                    
                    String newFlow = data2[0] + " " + data2[1] + "\t" + data2[2]
                    + "\t" + data2[3] + "\t" + data2[4] + "\t0\t" + data2[5] 
                    + "\t" + data2[6] + "\t0\t" + data2[9]
                    + "\t" + data2[10] + "\t" + data2[11] + "\t" + data2[12];
                    parsedFLows.add(newFlow);
                    continue;
                } else {
                System.out.println(f);
                continue;
                }
        }          
            String sip = data[3].split(":")[0];
            String sport;
            if (data[3].split(":").length == 1){
                sport = "0";
            } else 
                sport = data[3].split(":")[1];              
            
            String dip = data[5].split(":")[0];
            
            String dport;
            if (data[5].split(":").length == 1){
                dport = "0";
            } else 
                dport = data[5].split(":")[1]; 
            
            String newFlow = data[0] + "\t" + data[1] + "\t" + data[2]
                    + "\t" + sip + "\t" + sport + "\t" + data[4] 
                    + "\t" + dip + "\t" + dport + "\t" + data[8]
                    + "\t" + data[9] + "\t" + data[10] + "\t" + data[11];
            
            parsedFLows.add(newFlow);
        }
        
        System.out.println("Creating file...");
        File file = new File(filename + ".parsed");
        file.createNewFile();
        FileWriter writer = new FileWriter(file);
        for (String f : parsedFLows){
             writer.write(f + "\n");
             writer.flush();
        }
        writer.close();
    }
    
}