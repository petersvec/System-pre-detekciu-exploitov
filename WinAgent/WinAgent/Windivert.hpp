#pragma once

#include "Collector.hpp"
#include "Configuration.hpp"

#include <windivert.h>
#include <ctime>
#include <fstream>
#include <iomanip>

class Windivert {
private:
	// handle na windivert
	HANDLE mWindivert;

	// pointer na data packetu
	char *mPacket;

	// casovac pre odosielnanie packetov
	std::clock_t start;
	std::clock_t end;

	// zapis paketu do suboru
	void writePacket(char *data, UINT size);

	// stream na zapis
	std::ofstream mOutput;

	// subor s paketmi
	std::string mPacketFile{ "" };

	// konvertovanie casoveho formatu
	time_t convert(SYSTEMTIME st);

public:
	Windivert();
	~Windivert();

	// inicializacia
	bool init(const Configuration &config);

	// spustenie zachytavania
	void run(const Configuration &config);
};
